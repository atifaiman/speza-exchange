<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <meta name="theme-color" content="#000000">
    <meta name="ui-version" content="%REACT_APP_GIT_SHA%"/>
    <meta http-equiv=“Pragma” content=”no-cache”>
    <meta http-equiv=“Expires” content=”-1″>
    <meta http-equiv=“CACHE-CONTROL” content=”NO-CACHE”>
    <!--
      manifest.json provides metadata used when your web app is added to the
      homescreen on Android. See https://developers.google.com/web/fundamentals/engage-and-retain/web-app-manifest/
    -->
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json">
    <link rel="shortcut icon" href="%PUBLIC_URL%/favicon.ico">
    <link rel="stylesheet" href="../node_modules/@openware/cryptofont/font/crypto-font.css">
    <link rel="stylesheet" href="./css/theme.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <!--
      Notice the use of %PUBLIC_URL% in the tags above.
      It will be replaced with the URL of the `public` folder during the build.
      Only files inside the `public` folder can be referenced from the HTML.

      Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will
      work correctly both with client-side routing and a non-root public URL.
      Learn how to configure a non-root public URL by running `npm run build`.
    -->
    <title>Speza</title>
  </head>
  <body>
    <script src="%PUBLIC_URL%/config/env.js"></script>
    <noscript>
        You need to enable JavaScript to run this app.
    </noscript>
    <div id="root"></div>
    <div id="awepay" style="display: none;"></div>
    <!--
      This HTML file is a template.
      If you open it directly in the browser, you will see an empty page.

      You can add webfonts, meta tags, or analytics to this file.
      The build step will place the bundled scripts into the <body> tag.

      To begin the development, run `npm start` or `yarn start`.
      To create a production bundle, use `npm run build` or `yarn build`.
    -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0/dist/Chart.min.js"></script>
    <script type="text/javascript">
       var ifr = document.getElementById("JotFormIFrame-91061490714453"); if(window.location.href && window.location.href.indexOf("?") > -1) { var get = window.location.href.substr(window.location.href.indexOf("?") + 1); if(ifr && get.length > 0) { var src = ifr.src; src = src.indexOf("?") > -1 ? src + "&" + get : src + "?" + get; ifr.src = src; } } window.handleIFrameMessage = function(e) { if (typeof e.data === 'object') { return; } var args = e.data.split(":"); if (args.length > 2) { iframe = document.getElementById("JotFormIFrame-" + args[(args.length - 1)]); } else { iframe = document.getElementById("JotFormIFrame"); } if (!iframe) { return; } switch (args[0]) { case "scrollIntoView": iframe.scrollIntoView(); break; case "setHeight": iframe.style.height = args[1] + "px"; break; case "collapseErrorPage": if (iframe.clientHeight > window.innerHeight) { iframe.style.height = window.innerHeight + "px"; } break; case "reloadPage": window.location.reload(); break; case "loadScript": var src = args[1]; if (args.length > 3) { src = args[1] + ':' + args[2]; } var script = document.createElement('script'); script.src = src; script.type = 'text/javascript'; document.body.appendChild(script); break; case "exitFullscreen": if (window.document.exitFullscreen) window.document.exitFullscreen(); else if (window.document.mozCancelFullScreen) window.document.mozCancelFullScreen(); else if (window.document.mozCancelFullscreen) window.document.mozCancelFullScreen(); else if (window.document.webkitExitFullscreen) window.document.webkitExitFullscreen(); else if (window.document.msExitFullscreen) window.document.msExitFullscreen(); break; } var isJotForm = (e.origin.indexOf("jotform") > -1) ? true : false; if(isJotForm && "contentWindow" in iframe && "postMessage" in iframe.contentWindow) { var urls = {"docurl":encodeURIComponent(document.URL),"referrer":encodeURIComponent(document.referrer)}; iframe.contentWindow.postMessage(JSON.stringify({"type":"urls","value":urls}), "*"); } }; if (window.addEventListener) { window.addEventListener("message", handleIFrameMessage, false); } else if (window.attachEvent) { window.attachEvent("onmessage", handleIFrameMessage); }
    </script>
    <script>
// Filter search bar
      function myFunction() {
         // Declare variables 
         var input, filter, table, tr, td, i, txtValue;
         input = document.getElementById("myInput");
         filter = input.value.toUpperCase();
         table = document.getElementById("myTable");
         tr = table.getElementsByTagName("tr");
       
         // Loop through all table rows, and hide those who don't match the search query
         for (i = 0; i < tr.length; i++) {
           td = tr[i].getElementsByTagName("td")[0];
           if (td) {
             txtValue = td.textContent || td.innerText;
             if (txtValue.toUpperCase().indexOf(filter) > -1) {
               tr[i].style.display = "";
             } else {
               tr[i].style.display = "none";
             }
           } 
         }
       }
///////////////////////////////////////////
                  
  const tradepath = window.env.api.tradeUrl;
  
///////////////////////////////////////////
// marketpair array
    var height = 100;
    var width = 80;
    var milliseconds = (new Date).getTime();
    var earlier = milliseconds - 1 * 24 * 60 * 60 * 1000; // last 24 hoursc
/*
[0]  id: "maticbtc"
[1]  name: "MATIC/BTC"
[2]  avg_price: "0.00001568067477768"
[3]  buy: "0.00001467"
[4]  high: "0.00001605"
[5]  last: "0.00001598"
[6]  low: "0.00001551"
[7]  open: 0.00001564
[8]  price_change_percent: "+2.17%"
[9]  sell: "0.00001725"
[10] vol: "0.020309"
[11] volume: "0.020309"
*/
    try {
      var request = new XMLHttpRequest();
      request.open('GET', tradepath +  '/public/markets/', true);
      request.setRequestHeader('Access-Control-Allow-Headers', 'Origin, Content-Type, X-Auth-Token');
      request.setRequestHeader('Access-Control-Allow-Origin', '*');
      request.setRequestHeader('Access-Control-Allow-Method', 'GET');      
      request.setRequestHeader('Content-Type', 'application/json');
      request.send();
      request.onload = function() {
      var data = JSON.parse(this.response);
      var marketNames = new Array(data.length);
      for (var i = 0; i < marketNames.length; i++) {
        marketNames[i] = new Array(13);
      }
      for (h=0; h < data.length; h++ ){
        marketNames[h][0] = data[h].id;
        marketNames[h][1] = data[h].name;
      }
      try {

          var request = new XMLHttpRequest();
          request.open('GET', tradepath + '/public/markets/tickers/', true);
          //request.open('GET', 'https://www.speza.exchange/api/v2/peatio/public/markets/tickers/', true)
          request.setRequestHeader('Access-Control-Allow-Headers', 'Origin, Content-Type, X-Auth-Token');
          request.setRequestHeader('Access-Control-Allow-Origin', '*');
          request.setRequestHeader('Access-Control-Allow-Method', 'GET');
          request.setRequestHeader('Content-Type', 'application/json');
          request.send();
          request.onload = function() {
            var data = JSON.parse(this.response);
            for (var i=0 ; i < marketNames.length ; i++ ){
              marketNames[i][2]= data[marketNames[i][0]].ticker.avg_price;
              marketNames[i][3]= data[marketNames[i][0]].ticker.buy;
              marketNames[i][4]= data[marketNames[i][0]].ticker.high;
              marketNames[i][5]= data[marketNames[i][0]].ticker.last;
              marketNames[i][6]= data[marketNames[i][0]].ticker.low;
              marketNames[i][7]= data[marketNames[i][0]].ticker.open;
              marketNames[i][8]= data[marketNames[i][0]].ticker.price_change_percent;
              marketNames[i][9]= data[marketNames[i][0]].ticker.sell;
              marketNames[i][10]= data[marketNames[i][0]].ticker.vol;
              marketNames[i][11]= data[marketNames[i][0]].ticker.volume;
            } 
            try {
            var requestGraph = new XMLHttpRequest();
            requestGraph.open('GET', tradepath + '/public/markets/k-line?period=1440&time_from='+ earlier.toString().substring(0, 10) + '&time_to='+ milliseconds, true);
            requestGraph.setRequestHeader('Access-Control-Allow-Headers', 'Origin, Content-Type, X-Auth-Token');
            requestGraph.setRequestHeader('Access-Control-Allow-Origin', '*');
            requestGraph.setRequestHeader('Access-Control-Allow-Method', 'GET');
            requestGraph.setRequestHeader('Content-Type', 'application/json');
            requestGraph.send();
            requestGraph.onload = function() {
              if (requestGraph.status >= 200 && requestGraph.status < 400) {
                var data = JSON.parse(this.response);
                for (var i = 0; i < marketNames.length; i++) {
                  marketNames[i][12] = data[marketNames[i][0]];
                }
                var marketStack = [];
                marketStack.push(marketNames[0][1].split("/")[1]);
                for (var i=0 ; i < marketNames.length ; i++ ){
                    if (marketStack[marketStack.length -1] != marketNames[i][1].split("/")[1] ) {
                      marketStack.push(marketNames[i][1].split("/")[1]);
                    }
                }
                var marketList = new Array(marketStack.length);
                for (var i=0 ; i < marketStack.length ; i++ ){
                  marketList[i] = [];
                }
                var currentMarket = 0;
                for (var i=0 ; i < marketNames.length ; i++ ){
                    if (marketStack[currentMarket] === marketNames[i][1].split("/")[1] ) {
                      marketList[currentMarket].push(marketNames[i]);
                    } else {
                      currentMarket++;
                      marketList[currentMarket].push(marketNames[i]);
                    }
                }
        
              // window.onload = function() {
                var MarketTabs = '<ul  style=\" margin: auto; width:80%; \" class=\"nav nav-tabs\"><li><a data-toggle=\"tab\" href=\"#'+ marketStack[0].toLowerCase() +'\">' + marketStack[0] + '</a></li>';
                for (var i=1 ; i < marketStack.length ; i++ ){
                    MarketTabs += '<li><a data-toggle=\"tab\" href=\"#' + marketStack[i].toLowerCase() + '\">'+ marketStack[i] +'</a></li>';
                }
                    MarketTabs += '</ul><div class=\"tab-content\"><div  id=\"'+marketStack[0].toLowerCase()+'\"  class=\"tab-pane fade in active\"><div  id=\"'+ marketStack[0] +'\"></div></div>';
                for (var i=1 ; i < marketStack.length ; i++ ){
                    MarketTabs +='<div  id=\"'+ marketStack[i].toLowerCase() +'\"  class=\"tab-pane fade in active\"><div  id=\"'+ marketStack[i]+ '\"></div></div>';
                }
                MarketTabs +='</div>';
                document.getElementById("Markets").innerHTML = MarketTabs;
                // $("Markets").ready( function() {
                  // document.getElementById("Markets").innerHTML = MarketTabs;
                // });
                for (var k=0 ; k < marketStack.length; k++){
                  var marketDATA = "";
                  marketDATA += "<div style=\" padding: 20px 0px; margin-left:-2px; \"><table style=\" margin: auto; width:80%; \" class=\"fixed_header table-hover\"><thead><tr><th></th></tr><tr style=\" font-size: 16px; \"><th style=\"padding-left:15px;\">Market</th><th>Buy</th><th>Sell</th><th class=\"chartMobile\" >Low</th><th class=\"chartMobile\" >High</th><th class=\"chartMobile\" >Open</th><th class=\"chartMobile\" >Last</th><th  class=\"chartMobile\" >Volume</th><th>Price Change</th><th>Graph</th></tr></thead><tbody>";
                  for (var t=0 ; t < marketList[k].length; t++){
                    marketDATA += "<tr class=\"marketrow\"  onclick=\"window.open(\'https://www.speza.exchange/trading/" + marketList[0][t][0] + " \');\">";
                    marketDATA += "<td class=\"marketpais\" >";
                    marketDATA += marketList[k][t][1] + "</td>";
                    marketDATA += "<td  style=\" color: #4DD77C;\">";
                    marketDATA += marketList[k][t][3]+ "</td>";
                    marketDATA += "<td style=\" color: #FF1479;\">";
                    marketDATA += marketList[k][t][9] + "</td>";
                    marketDATA += "<td class=\"chartMobile\" >";
                    marketDATA += marketList[k][t][6] + "</td>";
                    marketDATA += "<td class=\"chartMobile\" >";
                    marketDATA += marketList[k][t][4]  + "</td>";
                    marketDATA += "<td class=\"chartMobile\" >";
                    marketDATA += marketList[k][t][7] + "</td>";
                    marketDATA += "<td class=\"chartMobile\" >";
                    marketDATA += marketList[k][t][5] + "</td>";
                    marketDATA += "<td  class=\"chartMobile\" >";
                    marketDATA += marketList[k][t][11] + "</td>";
                      if( marketList[k][t][8][0] === "+" ){
                        marketDATA += "<td style=\" color:#4DD77C;\">";
                      } else{
                        marketDATA += "<td style=\" color: #FF1479;\">";
                      }
                      // marketDATA += marketList[k][t][8] +'</td><td class=\"marketGraph\" ><canvas id=\"' + marketList[k][t][0] + '\" width=\"'+ width +'\" height=\"'+ height +'\" /></td>';
                      marketDATA += marketList[k][t][8] +'</td><td><div class=\"chart-container\"><canvas id=\"' + marketList[k][t][0] + '\"/></div></td>';
                      marketDATA += "</tr>";
                    }  
                  marketDATA += " <tr style=\"padding-top:100px;\"><td>&nbsp;</td></tr></tbody></table></div>";
                  document.getElementById(marketStack[k]).innerHTML = marketDATA;
                  // $(marketStack[k]).ready( function() {
                  //       document.getElementById(marketStack[k]).innerHTML = marketDATA;
                  // });
                    for (var t=0 ; t < marketList[k].length; t++){
                      var bar_ctx = document.getElementById(marketList[k][t][0]).getContext('2d');
                      var gradient = bar_ctx.createLinearGradient(0, 0, 0, 65);
                      gradient.addColorStop(0, 'rgba(250,174,50,1)');   
                      gradient.addColorStop(1, 'rgba(250,174,50,0)');

                        new Chart(document.getElementById(marketList[k][t][0]), {
                          type: 'line',
                          data: {
                            labels: [1,2,3,4,5,6,7,8],
                            datasets: [{ 
                                data: [marketList[k][t][12][0][1], marketList[k][t][12][0][2] ,marketList[k][t][12][0][3] ,marketList[k][t][12][0][4] ,marketList[k][t][12][1][1] ,marketList[k][t][12][1][2] ,marketList[k][t][12][1][3] ,marketList[k][t][12][0][4]],
                                //data: [3,5,9,7,8,6,3,5],
                                backgroundColor: gradient,
                                label: "Africa",
                                borderColor: "#3e95cd",
                                fill: true,
                              },
                            ]
                          },
                          options: {
                            title: {
                              display: false,
                            },
                            legend: {
                              display: false
                            },
                            tooltips: {
                              enabled: false
                            },
                            scales: {
                              xAxes: [{
                                display: false
                              }],
                              yAxes: [{
                                display: false,
                                ticks: {
                                    beginAtZero: true
                                }
                              }]
                          }   
                          }
                        });
                    }
              }
              
                // console.log(marketNames);//all Pairs
                // console.log(marketStack);// all the markets
                // console.log(marketList);// all Pairs in each of the markets
              } else {
              }
              }      
            }
            catch(err) {
              location.reload(true);
            } 
          } 
          } catch(err) {
          location.reload(true);
          }
     }
    } catch(err) {
      location.reload(true);
    }
    </script>

  </body>
</html>
